{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/Message.tsx"],"sourcesContent":["'use client';\n\nimport { useRef, useEffect } from 'react';\nimport { Play, Pause } from 'lucide-react';\n\ninterface MessageProps {\n  message: {\n    role: 'user' | 'assistant';\n    content: string;\n    audio_url?: string;\n  };\n  messageIndex: number;\n  audioRefsRef: React.MutableRefObject<{ [key: number]: HTMLAudioElement }>;\n  isPlaying: boolean;\n  onPlayAudio: (index: number) => void;\n  onAudioEnded: () => void;\n}\n\nexport default function Message({\n  message,\n  messageIndex,\n  audioRefsRef,\n  isPlaying,\n  onPlayAudio,\n  onAudioEnded,\n}: MessageProps) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  useEffect(() => {\n    if (audioRef.current) {\n      audioRefsRef.current[messageIndex] = audioRef.current;\n    }\n  }, [messageIndex, audioRefsRef]);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    if (isPlaying) {\n      audio.play().catch((err) => console.error('Error playing audio:', err));\n    } else {\n      audio.pause();\n    }\n  }, [isPlaying]);\n\n  const togglePlay = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (isPlaying) {\n      // Stop current playback\n      if (audioRef.current) {\n        audioRef.current.pause();\n      }\n      onAudioEnded();\n    } else {\n      // Start playback\n      onPlayAudio(messageIndex);\n    }\n  };\n\n  return (\n    <div className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n      <div\n        className={`max-w-md px-4 py-3 rounded-lg ${\n          message.role === 'user'\n            ? 'bg-green-600 text-white'\n            : 'bg-gray-700 text-gray-100'\n        }`}\n      >\n        <p className=\"text-sm break-words\">{message.content}</p>\n\n        {message.audio_url && (\n          <div className=\"mt-3 flex items-center gap-3\">\n            <button\n              onClick={togglePlay}\n              className={`transition p-2 rounded ${\n                isPlaying\n                  ? 'bg-red-600 hover:bg-red-500'\n                  : 'bg-gray-800 hover:bg-gray-600'\n              }`}\n              title={isPlaying ? 'Pause' : 'Play'}\n            >\n              {isPlaying ? (\n                <Pause size={18} className=\"text-white\" />\n              ) : (\n                <Play size={18} className=\"text-white\" />\n              )}\n            </button>\n            <span className=\"text-xs text-gray-300\">\n              {isPlaying ? 'Playing...' : 'Audio'}\n            </span>\n            <audio\n              ref={audioRef}\n              src={message.audio_url}\n              onEnded={onAudioEnded}\n              crossOrigin=\"anonymous\"\n              className=\"hidden\"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAHA;;;;AAkBe,SAAS,QAAQ,EAC9B,OAAO,EACP,YAAY,EACZ,YAAY,EACZ,SAAS,EACT,WAAW,EACX,YAAY,EACC;IACb,MAAM,WAAW,IAAA,gQAAM,EAAmB;IAE1C,IAAA,mQAAS,EAAC;QACR,IAAI,SAAS,OAAO,EAAE;YACpB,aAAa,OAAO,CAAC,aAAa,GAAG,SAAS,OAAO;QACvD;IACF,GAAG;QAAC;QAAc;KAAa;IAE/B,IAAA,mQAAS,EAAC;QACR,MAAM,QAAQ,SAAS,OAAO;QAC9B,IAAI,CAAC,OAAO;QAEZ,IAAI,WAAW;YACb,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,MAAQ,QAAQ,KAAK,CAAC,wBAAwB;QACpE,OAAO;YACL,MAAM,KAAK;QACb;IACF,GAAG;QAAC;KAAU;IAEd,MAAM,aAAa,CAAC;QAClB,EAAE,cAAc;QAChB,EAAE,eAAe;QAEjB,IAAI,WAAW;YACb,wBAAwB;YACxB,IAAI,SAAS,OAAO,EAAE;gBACpB,SAAS,OAAO,CAAC,KAAK;YACxB;YACA;QACF,OAAO;YACL,iBAAiB;YACjB,YAAY;QACd;IACF;IAEA,qBACE,+RAAC;QAAI,WAAW,CAAC,KAAK,EAAE,QAAQ,IAAI,KAAK,SAAS,gBAAgB,iBAAiB;kBACjF,cAAA,+RAAC;YACC,WAAW,CAAC,8BAA8B,EACxC,QAAQ,IAAI,KAAK,SACb,4BACA,6BACJ;;8BAEF,+RAAC;oBAAE,WAAU;8BAAuB,QAAQ,OAAO;;;;;;gBAElD,QAAQ,SAAS,kBAChB,+RAAC;oBAAI,WAAU;;sCACb,+RAAC;4BACC,SAAS;4BACT,WAAW,CAAC,uBAAuB,EACjC,YACI,gCACA,iCACJ;4BACF,OAAO,YAAY,UAAU;sCAE5B,0BACC,+RAAC,8PAAK;gCAAC,MAAM;gCAAI,WAAU;;;;;qDAE3B,+RAAC,2PAAI;gCAAC,MAAM;gCAAI,WAAU;;;;;;;;;;;sCAG9B,+RAAC;4BAAK,WAAU;sCACb,YAAY,eAAe;;;;;;sCAE9B,+RAAC;4BACC,KAAK;4BACL,KAAK,QAAQ,SAAS;4BACtB,SAAS;4BACT,aAAY;4BACZ,WAAU;;;;;;;;;;;;;;;;;;;;;;;AAOxB"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/MessageList.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport Message from './Message';\n\ninterface MessageData {\n  role: 'user' | 'assistant';\n  content: string;\n  audio_url?: string;\n}\n\ninterface MessageListProps {\n  messages: MessageData[];\n  audioRefsRef: React.MutableRefObject<{ [key: number]: HTMLAudioElement }>;\n  playingIndex: number | null;\n  onPlayAudio: (index: number) => void;\n  onAudioEnded: () => void;\n}\n\nexport default function MessageList({\n  messages,\n  audioRefsRef,\n  playingIndex,\n  onPlayAudio,\n  onAudioEnded,\n}: MessageListProps) {\n  const endRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    endRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  return (\n    <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n      {messages.length === 0 ? (\n        <div className=\"flex items-center justify-center h-full text-gray-400\">\n          <p>Start a conversation...</p>\n        </div>\n      ) : (\n        messages.map((message, index) => (\n          <Message\n            key={index}\n            message={message}\n            messageIndex={index}\n            audioRefsRef={audioRefsRef}\n            isPlaying={playingIndex === index}\n            onPlayAudio={onPlayAudio}\n            onAudioEnded={onAudioEnded}\n          />\n        ))\n      )}\n      <div ref={endRef} />\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAmBe,SAAS,YAAY,EAClC,QAAQ,EACR,YAAY,EACZ,YAAY,EACZ,WAAW,EACX,YAAY,EACK;IACjB,MAAM,SAAS,IAAA,gQAAM,EAAiB;IAEtC,IAAA,mQAAS,EAAC;QACR,OAAO,OAAO,EAAE,eAAe;YAAE,UAAU;QAAS;IACtD,GAAG;QAAC;KAAS;IAEb,qBACE,+RAAC;QAAI,WAAU;;YACZ,SAAS,MAAM,KAAK,kBACnB,+RAAC;gBAAI,WAAU;0BACb,cAAA,+RAAC;8BAAE;;;;;;;;;;uBAGL,SAAS,GAAG,CAAC,CAAC,SAAS,sBACrB,+RAAC,yLAAO;oBAEN,SAAS;oBACT,cAAc;oBACd,cAAc;oBACd,WAAW,iBAAiB;oBAC5B,aAAa;oBACb,cAAc;mBANT;;;;;0BAUX,+RAAC;gBAAI,KAAK;;;;;;;;;;;;AAGhB"}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/ChatWindow.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Send, Mic, Square } from 'lucide-react';\nimport MessageList from './MessageList';\n\ninterface Message {\n  role: 'user' | 'assistant';\n  content: string;\n  audio_url?: string;\n}\n\ninterface ChatWindowProps {\n  sessionId: string;\n}\n\nexport default function ChatWindow({ sessionId }: ChatWindowProps) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [playingIndex, setPlayingIndex] = useState<number | null>(null);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const audioRefsRef = useRef<{ [key: number]: HTMLAudioElement }>({});\n\n  // Fetch chat history on mount\n  useEffect(() => {\n    fetchChatHistory();\n  }, [sessionId]);\n\n  const fetchChatHistory = async () => {\n    try {\n      const response = await fetch(`http://localhost:5000/chat/history/${sessionId}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch history');\n      }\n      const data = await response.json();\n\n      const formattedMessages: Message[] = data.map((item: any) => ({\n        role: item.role,\n        content: item.transcript,\n        audio_url: item.audio_url,\n      }));\n\n      setMessages(formattedMessages);\n    } catch (error) {\n      console.error('Failed to fetch history:', error);\n    }\n  };\n\n  const sendMessage = async (text: string) => {\n    if (!text.trim()) return;\n\n    setMessages((prev) => [...prev, { role: 'user', content: text }]);\n    setInput('');\n    setLoading(true);\n    setPlayingIndex(null);\n\n    try {\n      const response = await fetch(`http://localhost:5000/chat/${sessionId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ message: text, mode: 'text' }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send message');\n      }\n\n      const data = await response.json();\n      if (data.message) {\n        setMessages((prev) => [\n          ...prev,\n          { role: 'assistant', content: data.message, audio_url: data.audio_url },\n        ]);\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      const mediaRecorder = new MediaRecorder(stream);\n\n      mediaRecorder.ondataavailable = (event) => {\n        audioChunksRef.current.push(event.data);\n      };\n\n      mediaRecorder.onstop = async () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n        audioChunksRef.current = [];\n\n        const reader = new FileReader();\n        reader.onloadend = async () => {\n          const base64Audio = (reader.result as string).split(',')[1];\n          await sendAudio(base64Audio);\n        };\n        reader.readAsDataURL(audioBlob);\n\n        stream.getTracks().forEach((track) => track.stop());\n      };\n\n      mediaRecorder.start();\n      mediaRecorderRef.current = mediaRecorder;\n      setIsRecording(true);\n      setPlayingIndex(null);\n    } catch (error) {\n      console.error('Error accessing microphone:', error);\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const sendAudio = async (base64Audio: string) => {\n    setLoading(true);\n    setPlayingIndex(null);\n\n    try {\n      const response = await fetch(`http://localhost:5000/audio/interact/${sessionId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ audio: base64Audio }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send audio');\n      }\n\n      const data = await response.json();\n      if (data.user_said) {\n        const assistantMsgIndex = messages.length + 1;\n\n        setMessages((prev) => [\n          ...prev,\n          { role: 'user', content: data.user_said },\n          {\n            role: 'assistant',\n            content: data.assistant_said,\n            audio_url: data.audio_url,\n          },\n        ]);\n\n        // Auto-play assistant response after a short delay\n        setTimeout(() => {\n          playAudio(assistantMsgIndex);\n        }, 500);\n      }\n    } catch (error) {\n      console.error('Error sending audio:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const playAudio = (messageIndex: number) => {\n    // Stop any currently playing audio\n    Object.entries(audioRefsRef.current).forEach(([idx, audio]) => {\n      if (parseInt(idx) !== messageIndex) {\n        audio.pause();\n      }\n    });\n\n    setPlayingIndex(messageIndex);\n\n    const audio = audioRefsRef.current[messageIndex];\n    if (audio) {\n      audio.play().catch((err) => console.error('Error playing audio:', err));\n    }\n  };\n\n  const handleAudioEnded = () => {\n    setPlayingIndex(null);\n  };\n\n  return (\n    <div className=\"flex-1 flex flex-col bg-gray-900 text-white overflow-hidden\">\n      {/* Header */}\n      <div className=\"border-b border-gray-700 p-4 flex-shrink-0\">\n        <h1 className=\"text-xl font-bold\">Spotify DJ Agent</h1>\n        <p className=\"text-sm text-gray-400\">Session: {sessionId}</p>\n      </div>\n\n      {/* Messages */}\n      <MessageList\n        messages={messages}\n        audioRefsRef={audioRefsRef}\n        playingIndex={playingIndex}\n        onPlayAudio={playAudio}\n        onAudioEnded={handleAudioEnded}\n      />\n\n      {/* Input Area */}\n      <div className=\"border-t border-gray-700 p-4 space-y-3 flex-shrink-0\">\n        <div className=\"flex gap-2\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            onKeyPress={(e) => e.key === 'Enter' && !loading && sendMessage(input)}\n            placeholder=\"Type a message...\"\n            className=\"flex-1 bg-gray-800 text-white rounded-lg px-4 py-2 border border-gray-700 focus:outline-none focus:border-green-600\"\n            disabled={loading || isRecording}\n          />\n          <button\n            onClick={() => sendMessage(input)}\n            disabled={loading || !input.trim()}\n            className=\"bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white p-2 rounded-lg transition\"\n          >\n            <Send size={20} />\n          </button>\n        </div>\n\n        {/* Microphone Button */}\n        <button\n          onClick={isRecording ? stopRecording : startRecording}\n          disabled={loading}\n          className={`w-full flex items-center justify-center gap-2 py-2 px-4 rounded-lg font-semibold transition ${\n            isRecording\n              ? 'bg-red-600 hover:bg-red-700'\n              : 'bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600'\n          }`}\n        >\n          {isRecording ? (\n            <>\n              <Square size={20} />\n              Stop Recording\n            </>\n          ) : (\n            <>\n              <Mic size={20} />\n              Start Recording\n            </>\n          )}\n        </button>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AACA;AAJA;;;;;AAgBe,SAAS,WAAW,EAAE,SAAS,EAAmB;IAC/D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,kQAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,kQAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,kQAAQ,EAAC;IACvC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,kQAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,kQAAQ,EAAgB;IAChE,MAAM,mBAAmB,IAAA,gQAAM,EAAuB;IACtD,MAAM,iBAAiB,IAAA,gQAAM,EAAS,EAAE;IACxC,MAAM,eAAe,IAAA,gQAAM,EAAsC,CAAC;IAElE,8BAA8B;IAC9B,IAAA,mQAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAU;IAEd,MAAM,mBAAmB;QACvB,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,CAAC,mCAAmC,EAAE,WAAW;YAC9E,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,MAAM,oBAA+B,KAAK,GAAG,CAAC,CAAC,OAAc,CAAC;oBAC5D,MAAM,KAAK,IAAI;oBACf,SAAS,KAAK,UAAU;oBACxB,WAAW,KAAK,SAAS;gBAC3B,CAAC;YAED,YAAY;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;QAC5C;IACF;IAEA,MAAM,cAAc,OAAO;QACzB,IAAI,CAAC,KAAK,IAAI,IAAI;QAElB,YAAY,CAAC,OAAS;mBAAI;gBAAM;oBAAE,MAAM;oBAAQ,SAAS;gBAAK;aAAE;QAChE,SAAS;QACT,WAAW;QACX,gBAAgB;QAEhB,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,CAAC,2BAA2B,EAAE,WAAW,EAAE;gBACtE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,SAAS;oBAAM,MAAM;gBAAO;YACrD;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,IAAI,KAAK,OAAO,EAAE;gBAChB,YAAY,CAAC,OAAS;2BACjB;wBACH;4BAAE,MAAM;4BAAa,SAAS,KAAK,OAAO;4BAAE,WAAW,KAAK,SAAS;wBAAC;qBACvE;YACH;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0BAA0B;QAC1C,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,iBAAiB;QACrB,IAAI;YACF,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;YACvE,MAAM,gBAAgB,IAAI,cAAc;YAExC,cAAc,eAAe,GAAG,CAAC;gBAC/B,eAAe,OAAO,CAAC,IAAI,CAAC,MAAM,IAAI;YACxC;YAEA,cAAc,MAAM,GAAG;gBACrB,MAAM,YAAY,IAAI,KAAK,eAAe,OAAO,EAAE;oBAAE,MAAM;gBAAY;gBACvE,eAAe,OAAO,GAAG,EAAE;gBAE3B,MAAM,SAAS,IAAI;gBACnB,OAAO,SAAS,GAAG;oBACjB,MAAM,cAAc,AAAC,OAAO,MAAM,CAAY,KAAK,CAAC,IAAI,CAAC,EAAE;oBAC3D,MAAM,UAAU;gBAClB;gBACA,OAAO,aAAa,CAAC;gBAErB,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,QAAU,MAAM,IAAI;YAClD;YAEA,cAAc,KAAK;YACnB,iBAAiB,OAAO,GAAG;YAC3B,eAAe;YACf,gBAAgB;QAClB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,+BAA+B;QAC/C;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI,iBAAiB,OAAO,EAAE;YAC5B,iBAAiB,OAAO,CAAC,IAAI;YAC7B,eAAe;QACjB;IACF;IAEA,MAAM,YAAY,OAAO;QACvB,WAAW;QACX,gBAAgB;QAEhB,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,CAAC,qCAAqC,EAAE,WAAW,EAAE;gBAChF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,OAAO;gBAAY;YAC5C;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,IAAI,KAAK,SAAS,EAAE;gBAClB,MAAM,oBAAoB,SAAS,MAAM,GAAG;gBAE5C,YAAY,CAAC,OAAS;2BACjB;wBACH;4BAAE,MAAM;4BAAQ,SAAS,KAAK,SAAS;wBAAC;wBACxC;4BACE,MAAM;4BACN,SAAS,KAAK,cAAc;4BAC5B,WAAW,KAAK,SAAS;wBAC3B;qBACD;gBAED,mDAAmD;gBACnD,WAAW;oBACT,UAAU;gBACZ,GAAG;YACL;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wBAAwB;QACxC,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,YAAY,CAAC;QACjB,mCAAmC;QACnC,OAAO,OAAO,CAAC,aAAa,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;YACxD,IAAI,SAAS,SAAS,cAAc;gBAClC,MAAM,KAAK;YACb;QACF;QAEA,gBAAgB;QAEhB,MAAM,QAAQ,aAAa,OAAO,CAAC,aAAa;QAChD,IAAI,OAAO;YACT,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,MAAQ,QAAQ,KAAK,CAAC,wBAAwB;QACpE;IACF;IAEA,MAAM,mBAAmB;QACvB,gBAAgB;IAClB;IAEA,qBACE,+RAAC;QAAI,WAAU;;0BAEb,+RAAC;gBAAI,WAAU;;kCACb,+RAAC;wBAAG,WAAU;kCAAoB;;;;;;kCAClC,+RAAC;wBAAE,WAAU;;4BAAwB;4BAAU;;;;;;;;;;;;;0BAIjD,+RAAC,6LAAW;gBACV,UAAU;gBACV,cAAc;gBACd,cAAc;gBACd,aAAa;gBACb,cAAc;;;;;;0BAIhB,+RAAC;gBAAI,WAAU;;kCACb,+RAAC;wBAAI,WAAU;;0CACb,+RAAC;gCACC,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gCACxC,YAAY,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW,CAAC,WAAW,YAAY;gCAChE,aAAY;gCACZ,WAAU;gCACV,UAAU,WAAW;;;;;;0CAEvB,+RAAC;gCACC,SAAS,IAAM,YAAY;gCAC3B,UAAU,WAAW,CAAC,MAAM,IAAI;gCAChC,WAAU;0CAEV,cAAA,+RAAC,2PAAI;oCAAC,MAAM;;;;;;;;;;;;;;;;;kCAKhB,+RAAC;wBACC,SAAS,cAAc,gBAAgB;wBACvC,UAAU;wBACV,WAAW,CAAC,4FAA4F,EACtG,cACI,gCACA,sDACJ;kCAED,4BACC;;8CACE,+RAAC,iQAAM;oCAAC,MAAM;;;;;;gCAAM;;yDAItB;;8CACE,+RAAC,wPAAG;oCAAC,MAAM;;;;;;gCAAM;;;;;;;;;;;;;;;;;;;;AAQ/B"}},
    {"offset": {"line": 520, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/Sidebar.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { Plus, MessageCircle, Trash2 } from 'lucide-react';\nimport Link from 'next/link';\n\ninterface ConversationSummary {\n  session_id: string;\n  first_message: string;\n  message_count: number;\n  last_message_time: string;\n}\n\ninterface SidebarProps {\n  currentSessionId: string | null;\n  onNewChat: () => void;\n}\n\nexport default function Sidebar({ currentSessionId, onNewChat }: SidebarProps) {\n  const [conversations, setConversations] = useState<ConversationSummary[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchAllConversations();\n    const interval = setInterval(fetchAllConversations, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const fetchAllConversations = async () => {\n    try {\n      setError(null);\n      const response = await fetch('http://localhost:5000/chat/all-conversations', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      \n      if (Array.isArray(data)) {\n        setConversations(data);\n      } else {\n        setConversations([]);\n      }\n    } catch (error) {\n      console.error('Failed to fetch conversations:', error);\n      setError('Failed to load conversation history');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deleteConversation = async (sessionId: string, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    try {\n      const response = await fetch(`http://localhost:5000/chat/delete/${sessionId}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete conversation');\n      }\n\n      setConversations(conversations.filter((c) => c.session_id !== sessionId));\n    } catch (error) {\n      console.error('Failed to delete conversation:', error);\n      alert('Failed to delete conversation');\n    }\n  };\n\n  return (\n    <div className=\"w-64 bg-gray-800 text-white flex flex-col border-r border-gray-700 h-screen\">\n      {/* New Chat Button */}\n      <button\n        onClick={onNewChat}\n        className=\"m-4 flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition\"\n      >\n        <Plus size={20} />\n        New Chat\n      </button>\n\n      {/* Divider */}\n      <div className=\"px-4\">\n        <div className=\"h-px bg-gray-700\"></div>\n      </div>\n\n      {/* History Section */}\n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"px-4 py-3\">\n          <h2 className=\"text-xs uppercase tracking-wider text-gray-400 font-semibold\">\n            Conversation History\n          </h2>\n        </div>\n\n        {loading ? (\n          <div className=\"px-4 py-2 text-sm text-gray-400\">Loading conversations...</div>\n        ) : error ? (\n          <div className=\"px-4 py-2 text-sm text-red-400\">{error}</div>\n        ) : conversations.length === 0 ? (\n          <div className=\"px-4 py-2 text-sm text-gray-400\">No conversations yet</div>\n        ) : (\n          <div className=\"space-y-1 px-2\">\n            {conversations.map((conversation) => (\n              <Link\n                key={conversation.session_id}\n                href={`/chat/${conversation.session_id}`}\n                className={`block p-3 rounded-lg transition group ${\n                  currentSessionId === conversation.session_id\n                    ? 'bg-green-600 text-white'\n                    : 'bg-gray-700 hover:bg-gray-600 text-gray-100'\n                }`}\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <MessageCircle size={14} className=\"flex-shrink-0 mt-0.5\" />\n                      <p className=\"font-semibold text-sm truncate\">\n                        {conversation.first_message.substring(0, 25)}...\n                      </p>\n                    </div>\n                    <p className=\"text-xs text-gray-400 mt-1\">\n                      {conversation.message_count} messages\n                    </p>\n                    <span className=\"text-xs text-gray-500\">\n                      {new Date(conversation.last_message_time).toLocaleDateString()}\n                    </span>\n                  </div>\n                  <button\n                    onClick={(e) => deleteConversation(conversation.session_id, e)}\n                    className=\"opacity-0 group-hover:opacity-100 transition flex-shrink-0 mt-1\"\n                  >\n                    <Trash2 size={16} className=\"text-red-400 hover:text-red-300\" />\n                  </button>\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer */}\n      <div className=\"border-t border-gray-700 p-4\">\n        <button\n          onClick={fetchAllConversations}\n          disabled={loading}\n          className=\"w-full text-xs text-gray-400 hover:text-gray-200 transition disabled:opacity-50\"\n        >\n          Refresh History\n        </button>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 792, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/app/chat/%5BsessionId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport ChatWindow from '@/components/ChatWindow';\nimport Sidebar from '@/components/Sidebar';\n\nexport default function ChatPage() {\n  const [sessionId, setSessionId] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Create a new session on mount\n    const initSession = async () => {\n      try {\n        const response = await fetch('http://localhost:5000/chat/new', {\n          method: 'POST',\n        });\n        const data = await response.json();\n        setSessionId(data.session_id);\n      } catch (error) {\n        console.error('Failed to create session:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    initSession();\n  }, []);\n\n  const handleNewChat = async () => {\n    try {\n      const response = await fetch('http://localhost:5000/chat/new', {\n        method: 'POST',\n      });\n      const data = await response.json();\n      setSessionId(data.session_id);\n    } catch (error) {\n      console.error('Failed to create new session:', error);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"flex items-center justify-center h-screen\">Loading...</div>;\n  }\n\n  return (\n    <div className=\"flex h-screen bg-gray-900\">\n      <Sidebar sessionId={sessionId} onNewChat={handleNewChat} />\n      {sessionId && <ChatWindow sessionId={sessionId} />}\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,kQAAQ,EAAgB;IAC1D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,kQAAQ,EAAC;IAEvC,IAAA,mQAAS,EAAC;QACR,gCAAgC;QAChC,MAAM,cAAc;YAClB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM,kCAAkC;oBAC7D,QAAQ;gBACV;gBACA,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,aAAa,KAAK,UAAU;YAC9B,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,6BAA6B;YAC7C,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG,EAAE;IAEL,MAAM,gBAAgB;QACpB,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,kCAAkC;gBAC7D,QAAQ;YACV;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,aAAa,KAAK,UAAU;QAC9B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;QACjD;IACF;IAEA,IAAI,SAAS;QACX,qBAAO,+RAAC;YAAI,WAAU;sBAA4C;;;;;;IACpE;IAEA,qBACE,+RAAC;QAAI,WAAU;;0BACb,+RAAC,yLAAO;gBAAC,WAAW;gBAAW,WAAW;;;;;;YACzC,2BAAa,+RAAC,4LAAU;gBAAC,WAAW;;;;;;;;;;;;AAG3C"}}]
}