{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/Message.tsx"],"sourcesContent":["'use client';\n\nimport { useRef, useEffect } from 'react';\nimport { Play, Pause } from 'lucide-react';\n\ninterface MessageProps {\n  message: {\n    role: 'user' | 'assistant';\n    content: string;\n    audio_url?: string;\n  };\n  messageIndex: number;\n  audioRefsRef: React.MutableRefObject<{ [key: number]: HTMLAudioElement }>;\n  isPlaying: boolean;\n  onPlayAudio: (index: number) => void;\n  onAudioEnded: () => void;\n}\n\nexport default function Message({\n  message,\n  messageIndex,\n  audioRefsRef,\n  isPlaying,\n  onPlayAudio,\n  onAudioEnded,\n}: MessageProps) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  useEffect(() => {\n    if (audioRef.current) {\n      audioRefsRef.current[messageIndex] = audioRef.current;\n    }\n  }, [messageIndex, audioRefsRef]);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    if (isPlaying) {\n      audio.play().catch((err) => console.error('Error playing audio:', err));\n    } else {\n      audio.pause();\n    }\n  }, [isPlaying]);\n\n  const togglePlay = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (isPlaying) {\n      if (audioRef.current) {\n        audioRef.current.pause();\n      }\n      onAudioEnded();\n    } else {\n      onPlayAudio(messageIndex);\n    }\n  };\n\n  return (\n    <div className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n      <div\n        className={`max-w-xs px-4 py-3 rounded-lg ${\n          message.role === 'user'\n            ? 'bg-green-600/90 text-white'\n            : 'bg-gray-800/90 text-gray-100 border border-gray-700'\n        }`}\n      >\n        <p className=\"text-sm break-words\">{message.content}</p>\n\n        {message.audio_url && (\n          <div className=\"mt-3 flex items-center gap-3\">\n            <button\n              onClick={togglePlay}\n              className={`transition p-2 rounded ${\n                isPlaying\n                  ? 'bg-red-600 hover:bg-red-500'\n                  : 'bg-gray-700 hover:bg-gray-600'\n              }`}\n              title={isPlaying ? 'Pause' : 'Play'}\n            >\n              {isPlaying ? (\n                <Pause size={16} className=\"text-white\" />\n              ) : (\n                <Play size={16} className=\"text-white\" />\n              )}\n            </button>\n            <span className=\"text-xs text-gray-400\">\n              {isPlaying ? 'Playing...' : 'Audio'}\n            </span>\n            <audio\n              ref={audioRef}\n              src={message.audio_url}\n              onEnded={onAudioEnded}\n              crossOrigin=\"anonymous\"\n              className=\"hidden\"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAHA;;;;AAkBe,SAAS,QAAQ,EAC9B,OAAO,EACP,YAAY,EACZ,YAAY,EACZ,SAAS,EACT,WAAW,EACX,YAAY,EACC;IACb,MAAM,WAAW,IAAA,gQAAM,EAAmB;IAE1C,IAAA,mQAAS,EAAC;QACR,IAAI,SAAS,OAAO,EAAE;YACpB,aAAa,OAAO,CAAC,aAAa,GAAG,SAAS,OAAO;QACvD;IACF,GAAG;QAAC;QAAc;KAAa;IAE/B,IAAA,mQAAS,EAAC;QACR,MAAM,QAAQ,SAAS,OAAO;QAC9B,IAAI,CAAC,OAAO;QAEZ,IAAI,WAAW;YACb,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,MAAQ,QAAQ,KAAK,CAAC,wBAAwB;QACpE,OAAO;YACL,MAAM,KAAK;QACb;IACF,GAAG;QAAC;KAAU;IAEd,MAAM,aAAa,CAAC;QAClB,EAAE,cAAc;QAChB,EAAE,eAAe;QAEjB,IAAI,WAAW;YACb,IAAI,SAAS,OAAO,EAAE;gBACpB,SAAS,OAAO,CAAC,KAAK;YACxB;YACA;QACF,OAAO;YACL,YAAY;QACd;IACF;IAEA,qBACE,+RAAC;QAAI,WAAW,CAAC,KAAK,EAAE,QAAQ,IAAI,KAAK,SAAS,gBAAgB,iBAAiB;kBACjF,cAAA,+RAAC;YACC,WAAW,CAAC,8BAA8B,EACxC,QAAQ,IAAI,KAAK,SACb,+BACA,uDACJ;;8BAEF,+RAAC;oBAAE,WAAU;8BAAuB,QAAQ,OAAO;;;;;;gBAElD,QAAQ,SAAS,kBAChB,+RAAC;oBAAI,WAAU;;sCACb,+RAAC;4BACC,SAAS;4BACT,WAAW,CAAC,uBAAuB,EACjC,YACI,gCACA,iCACJ;4BACF,OAAO,YAAY,UAAU;sCAE5B,0BACC,+RAAC,8PAAK;gCAAC,MAAM;gCAAI,WAAU;;;;;qDAE3B,+RAAC,2PAAI;gCAAC,MAAM;gCAAI,WAAU;;;;;;;;;;;sCAG9B,+RAAC;4BAAK,WAAU;sCACb,YAAY,eAAe;;;;;;sCAE9B,+RAAC;4BACC,KAAK;4BACL,KAAK,QAAQ,SAAS;4BACtB,SAAS;4BACT,aAAY;4BACZ,WAAU;;;;;;;;;;;;;;;;;;;;;;;AAOxB"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/MessageList.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport Message from './Message';\n\ninterface MessageData {\n  role: 'user' | 'assistant';\n  content: string;\n  audio_url?: string;\n}\n\ninterface MessageListProps {\n  messages: MessageData[];\n  audioRefsRef: React.MutableRefObject<{ [key: number]: HTMLAudioElement }>;\n  playingIndex: number | null;\n  onPlayAudio: (index: number) => void;\n  onAudioEnded: () => void;\n}\n\nexport default function MessageList({\n  messages,\n  audioRefsRef,\n  playingIndex,\n  onPlayAudio,\n  onAudioEnded,\n}: MessageListProps) {\n  const endRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    endRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  return (\n    <div className=\"flex-1 overflow-y-auto px-4 py-6 w-full flex justify-center\">\n      <div className=\"max-w-2xl w-full space-y-4\">\n        {messages.length === 0 ? (\n          <div className=\"flex items-center justify-center h-full text-gray-400 text-center py-12\">\n            <div>\n              <div className=\"w-16 h-16 bg-green-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <span className=\"text-3xl\">â™ª</span>\n              </div>\n              <p className=\"text-lg\">Start a conversation</p>\n              <p className=\"text-sm text-gray-500 mt-2\">\n                Type a message or use voice to interact with the DJ Agent\n              </p>\n            </div>\n          </div>\n        ) : (\n          messages.map((message, index) => (\n            <Message\n              key={index}\n              message={message}\n              messageIndex={index}\n              audioRefsRef={audioRefsRef}\n              isPlaying={playingIndex === index}\n              onPlayAudio={onPlayAudio}\n              onAudioEnded={onAudioEnded}\n            />\n          ))\n        )}\n        <div ref={endRef} />\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAmBe,SAAS,YAAY,EAClC,QAAQ,EACR,YAAY,EACZ,YAAY,EACZ,WAAW,EACX,YAAY,EACK;IACjB,MAAM,SAAS,IAAA,gQAAM,EAAiB;IAEtC,IAAA,mQAAS,EAAC;QACR,OAAO,OAAO,EAAE,eAAe;YAAE,UAAU;QAAS;IACtD,GAAG;QAAC;KAAS;IAEb,qBACE,+RAAC;QAAI,WAAU;kBACb,cAAA,+RAAC;YAAI,WAAU;;gBACZ,SAAS,MAAM,KAAK,kBACnB,+RAAC;oBAAI,WAAU;8BACb,cAAA,+RAAC;;0CACC,+RAAC;gCAAI,WAAU;0CACb,cAAA,+RAAC;oCAAK,WAAU;8CAAW;;;;;;;;;;;0CAE7B,+RAAC;gCAAE,WAAU;0CAAU;;;;;;0CACvB,+RAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;;;;;2BAM9C,SAAS,GAAG,CAAC,CAAC,SAAS,sBACrB,+RAAC,yLAAO;wBAEN,SAAS;wBACT,cAAc;wBACd,cAAc;wBACd,WAAW,iBAAiB;wBAC5B,aAAa;wBACb,cAAc;uBANT;;;;;8BAUX,+RAAC;oBAAI,KAAK;;;;;;;;;;;;;;;;;AAIlB"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/ChatWindow.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Send, Mic, Square } from 'lucide-react';\nimport MessageList from './MessageList';\n\ninterface Message {\n  role: 'user' | 'assistant';\n  content: string;\n  audio_url?: string;\n}\n\ninterface ChatWindowProps {\n  sessionId: string;\n}\n\nexport default function ChatWindow({ sessionId }: ChatWindowProps) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [historyLoading, setHistoryLoading] = useState(true);\n  const [isRecording, setIsRecording] = useState(false);\n  const [playingIndex, setPlayingIndex] = useState<number | null>(null);\n  const [audioProcessing, setAudioProcessing] = useState(false);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const audioRefsRef = useRef<{ [key: number]: HTMLAudioElement }>({});\n\n  // Fetch chat history when sessionId changes\n  useEffect(() => {\n    fetchChatHistory();\n  }, [sessionId]);\n\n  const fetchChatHistory = async () => {\n    setHistoryLoading(true);\n    try {\n      const response = await fetch(`http://localhost:5000/chat/history/${sessionId}`);\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch history');\n      }\n\n      const data = await response.json();\n\n      if (Array.isArray(data)) {\n        const formattedMessages: Message[] = data.map((item: any) => ({\n          role: item.role,\n          content: item.transcript,\n          audio_url: item.audio_url,\n        }));\n        setMessages(formattedMessages);\n      } else {\n        setMessages([]);\n      }\n    } catch (error) {\n      console.error('Failed to fetch history:', error);\n      setMessages([]);\n    } finally {\n      setHistoryLoading(false);\n    }\n  };\n\n  const sendMessage = async (text: string) => {\n    if (!text.trim()) return;\n\n    const userMessage = { role: 'user' as const, content: text };\n    setMessages((prev) => [...prev, userMessage]);\n    setInput('');\n    setLoading(true);\n    setPlayingIndex(null);\n\n    try {\n      const response = await fetch(`http://localhost:5000/chat/${sessionId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ message: text, mode: 'text' }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send message');\n      }\n\n      const data = await response.json();\n      if (data.message) {\n        const assistantMessage: Message = {\n          role: 'assistant',\n          content: data.message,\n          audio_url: data.audio_url,\n        };\n        setMessages((prev) => [...prev, assistantMessage]);\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n      alert('Failed to send message');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      const mediaRecorder = new MediaRecorder(stream);\n\n      mediaRecorder.ondataavailable = (event) => {\n        audioChunksRef.current.push(event.data);\n      };\n\n      mediaRecorder.onstop = async () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n        audioChunksRef.current = [];\n\n        const reader = new FileReader();\n        reader.onloadend = async () => {\n          const base64Audio = (reader.result as string).split(',')[1];\n          await sendAudio(base64Audio);\n        };\n        reader.readAsDataURL(audioBlob);\n\n        stream.getTracks().forEach((track) => track.stop());\n      };\n\n      mediaRecorder.start();\n      mediaRecorderRef.current = mediaRecorder;\n      setIsRecording(true);\n      setPlayingIndex(null);\n    } catch (error) {\n      console.error('Error accessing microphone:', error);\n      alert('Could not access microphone');\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const sendAudio = async (base64Audio: string) => {\n    setLoading(true);\n    setAudioProcessing(true);\n    setPlayingIndex(null);\n\n    try {\n      const response = await fetch(`http://localhost:5000/audio/interact/${sessionId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ audio: base64Audio }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send audio');\n      }\n\n      const data = await response.json();\n\n      if (data.user_said && data.assistant_said) {\n        setMessages((prev) => [\n          ...prev,\n          { role: 'user', content: data.user_said },\n          {\n            role: 'assistant',\n            content: data.assistant_said,\n            audio_url: data.audio_url,\n          },\n        ]);\n\n        setTimeout(() => {\n          const assistantMsgIndex = messages.length + 1;\n          playAudio(assistantMsgIndex);\n          setAudioProcessing(false);\n        }, 300);\n      }\n    } catch (error) {\n      console.error('Error sending audio:', error);\n      alert('Failed to process audio');\n      setAudioProcessing(false);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const playAudio = (messageIndex: number) => {\n    Object.entries(audioRefsRef.current).forEach(([idx, audio]) => {\n      if (parseInt(idx) !== messageIndex && audio) {\n        audio.pause();\n        audio.currentTime = 0;\n      }\n    });\n\n    setPlayingIndex(messageIndex);\n\n    const audio = audioRefsRef.current[messageIndex];\n    if (audio) {\n      audio\n        .play()\n        .catch((err) => {\n          console.error('Error playing audio:', err);\n          setPlayingIndex(null);\n        });\n    } else {\n      console.warn(`Audio element not found for index ${messageIndex}`);\n      setPlayingIndex(null);\n    }\n  };\n\n  const handleAudioEnded = () => {\n    setPlayingIndex(null);\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-gradient-to-b from-gray-900 via-gray-900 to-black\">\n      {/* Conversation Display - Top Section */}\n      <div className=\"flex-1 overflow-hidden flex flex-col\">\n        {historyLoading ? (\n          <div className=\"flex-1 flex items-center justify-center text-gray-400\">\n            <p>Loading conversation...</p>\n          </div>\n        ) : (\n          <MessageList\n            messages={messages}\n            audioRefsRef={audioRefsRef}\n            playingIndex={playingIndex}\n            onPlayAudio={playAudio}\n            onAudioEnded={handleAudioEnded}\n          />\n        )}\n      </div>\n\n      {/* Input Section - Bottom Center */}\n      <div className=\"flex-shrink-0 bg-gradient-to-t from-black via-gray-900 to-transparent pt-8 pb-8 px-4\">\n        <div className=\"max-w-2xl mx-auto space-y-3\">\n          {/* Status Messages */}\n          {audioProcessing && (\n            <div className=\"text-center text-sm text-blue-400\">\n              Processing audio response...\n            </div>\n          )}\n\n          {isRecording && (\n            <div className=\"flex items-center justify-center gap-2 text-blue-400 text-sm\">\n              <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-pulse\"></div>\n              Recording audio...\n            </div>\n          )}\n\n          {/* Text Input */}\n          <div className=\"flex gap-2\">\n            <input\n              type=\"text\"\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyPress={(e) =>\n                e.key === 'Enter' && !loading && !historyLoading && sendMessage(input)\n              }\n              placeholder=\"Ask me anything...\"\n              className=\"flex-1 bg-gray-800/80 backdrop-blur-sm text-white rounded-lg px-4 py-3 border border-gray-700 focus:outline-none focus:border-green-600 focus:ring-1 focus:ring-green-600/50 placeholder-gray-400\"\n              disabled={loading || isRecording || historyLoading || audioProcessing}\n            />\n            <button\n              onClick={() => sendMessage(input)}\n              disabled={loading || !input.trim() || historyLoading || audioProcessing}\n              className=\"bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white p-3 rounded-lg transition shrink-0\"\n              title=\"Send message\"\n            >\n              <Send size={20} />\n            </button>\n          </div>\n\n          {/* Microphone Button */}\n          <button\n            onClick={isRecording ? stopRecording : startRecording}\n            disabled={loading || historyLoading || audioProcessing}\n            className={`w-full flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-semibold transition ${\n              isRecording\n                ? 'bg-red-600 hover:bg-red-700'\n                : 'bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600'\n            }`}\n          >\n            {isRecording ? (\n              <>\n                <Square size={20} />\n              </>\n            ) : (\n              <>\n                <Mic size={20} />\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 617, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/components/Sidebar.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { Plus, MessageCircle, Trash2 } from 'lucide-react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\n\ninterface ConversationSummary {\n  session_id: string;\n  first_message: string;\n  message_count: number;\n  last_message_time: string;\n}\n\ninterface SidebarProps {\n  currentSessionId: string | null;\n  onNewChat: () => void;\n  onClose?: () => void;\n}\n\nexport default function Sidebar({ currentSessionId, onNewChat, onClose }: SidebarProps) {\n  const [conversations, setConversations] = useState<ConversationSummary[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const router = useRouter();\n\n  useEffect(() => {\n    fetchAllConversations();\n    const interval = setInterval(fetchAllConversations, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const fetchAllConversations = async () => {\n    try {\n      setError(null);\n      const response = await fetch('http://localhost:5000/chat/all-conversations', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n\n      if (Array.isArray(data)) {\n        setConversations(data);\n      } else {\n        setConversations([]);\n      }\n      setLoading(false);\n    } catch (error) {\n      console.error('Failed to fetch conversations:', error);\n      setError('Failed to load conversation history');\n      setLoading(false);\n    }\n  };\n\n  const deleteConversation = async (sessionId: string, e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (!confirm('Are you sure you want to delete this conversation?')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`http://localhost:5000/chat/delete/${sessionId}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete conversation');\n      }\n\n      setConversations(conversations.filter((c) => c.session_id !== sessionId));\n\n      if (sessionId === currentSessionId) {\n        router.push('/');\n      }\n    } catch (error) {\n      console.error('Failed to delete conversation:', error);\n      alert('Failed to delete conversation');\n    }\n  };\n\n  const handleNewChat = async () => {\n    try {\n      const response = await fetch('http://localhost:5000/chat/new', {\n        method: 'POST',\n      });\n      if (!response.ok) {\n        throw new Error('Failed to create new chat');\n      }\n      const data = await response.json();\n      onClose?.();\n      router.push(`/chat/${data.session_id}`);\n    } catch (error) {\n      console.error('Failed to create new session:', error);\n      alert('Failed to create new chat');\n    }\n  };\n\n  const handleConversationClick = () => {\n    onClose?.();\n  };\n\n  return (\n    <div className=\"w-64 bg-gray-800 text-white flex flex-col border-r border-gray-700 h-screen overflow-hidden\">\n      {/* New Chat Button */}\n      <button\n        onClick={handleNewChat}\n        className=\"m-4 flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition\"\n      >\n        <Plus size={20} />\n        New Chat\n      </button>\n\n      {/* Divider */}\n      <div className=\"px-4\">\n        <div className=\"h-px bg-gray-700\"></div>\n      </div>\n\n      {/* History Section */}\n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"px-4 py-3\">\n          <h2 className=\"text-xs uppercase tracking-wider text-gray-400 font-semibold\">\n            Conversation History\n          </h2>\n        </div>\n\n        {loading ? (\n          <div className=\"px-4 py-2 text-sm text-gray-400\">Loading conversations...</div>\n        ) : error ? (\n          <div className=\"px-4 py-2 text-sm text-red-400\">{error}</div>\n        ) : conversations.length === 0 ? (\n          <div className=\"px-4 py-2 text-sm text-gray-400\">No conversations yet</div>\n        ) : (\n          <div className=\"space-y-1 px-2\">\n            {conversations.map((conversation) => (\n              <Link\n                key={conversation.session_id}\n                href={`/chat/${conversation.session_id}`}\n                onClick={handleConversationClick}\n                className={`block p-3 rounded-lg transition group ${\n                  currentSessionId === conversation.session_id\n                    ? 'bg-green-600 text-white'\n                    : 'bg-gray-700 hover:bg-gray-600 text-gray-100'\n                }`}\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <MessageCircle size={14} className=\"flex-shrink-0 mt-0.5\" />\n                      <p className=\"font-semibold text-sm truncate\">\n                        {conversation.first_message?.substring(0, 25) || 'Untitled'}...\n                      </p>\n                    </div>\n                    <p className=\"text-xs text-gray-400 mt-1\">\n                      {conversation.message_count} messages\n                    </p>\n                    <span className=\"text-xs text-gray-500\">\n                      {new Date(conversation.last_message_time).toLocaleDateString()}\n                    </span>\n                  </div>\n                  <button\n                    onClick={(e) => deleteConversation(conversation.session_id, e)}\n                    className=\"opacity-0 group-hover:opacity-100 transition flex-shrink-0 mt-1\"\n                  >\n                    <Trash2 size={16} className=\"text-red-400 hover:text-red-300\" />\n                  </button>\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer */}\n      <div className=\"border-t border-gray-700 p-4\">\n        <button\n          onClick={fetchAllConversations}\n          disabled={loading}\n          className=\"w-full text-xs text-gray-400 hover:text-gray-200 transition disabled:opacity-50\"\n        >\n          Refresh History\n        </button>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 918, "column": 0}, "map": {"version":3,"sources":["file:///home/yannis/Spotify_Agent/spotify-agent-frontend/src/app/chat/%5BsessionId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useParams } from 'next/navigation';\nimport { useState } from 'react';\nimport ChatWindow from '@/components/ChatWindow';\nimport Sidebar from '@/components/Sidebar';\nimport { Menu, X } from 'lucide-react';\n\nexport default function ChatPage() {\n  const params = useParams();\n  const sessionId = params.sessionId as string;\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  const handleNewChat = () => {\n    window.location.href = '/';\n  };\n\n  return (\n    <div className=\"flex h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-black\">\n      {/* Sidebar Toggle Button */}\n      <button\n        onClick={() => setSidebarOpen(!sidebarOpen)}\n        className=\"fixed top-4 left-4 z-50 p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition\"\n        title=\"Toggle sidebar\"\n      >\n        {sidebarOpen ? <X size={24} /> : <Menu size={24} />}\n      </button>\n\n      {/* Sidebar */}\n      {sidebarOpen && (\n        <div className=\"fixed inset-0 z-40 lg:relative lg:inset-auto\">\n          {/* Mobile overlay */}\n          <div\n            className=\"absolute inset-0 bg-black/50 lg:hidden\"\n            onClick={() => setSidebarOpen(false)}\n          />\n          {/* Sidebar content */}\n          <div className=\"relative z-40 h-full\">\n            <Sidebar\n              currentSessionId={sessionId}\n              onNewChat={handleNewChat}\n              onClose={() => setSidebarOpen(false)}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Main Chat Area */}\n      <div className=\"flex-1 flex flex-col items-center justify-center overflow-hidden bg-gray-900 relative\">\n        \n        {/* Centering Wrapper - This ensures vertical and horizontal alignment */}\n        <div className=\"w-full h-full flex items-center justify-center p-4 md:p-8\">\n          \n          {/* The Chat Window \"Container\" */}\n          {/* max-w-4xl keeps it readable, h-[85vh] prevents it from hitting the edges */}\n          <div className=\"w-full max-w-4xl h-[85vh] flex flex-col bg-gray-800/50 rounded-2xl border border-gray-700/50 shadow-2xl overflow-hidden\">\n            <ChatWindow sessionId={sessionId} />\n          </div>\n\n        </div>\n      </div>\n\n      {/* Agent Logo - Bottom Left */}\n      <div className=\"fixed bottom-4 left-4 z-50\">\n        <div \n          style={{ \n            width: '48px', \n            height: '48px', \n            display: 'flex', \n            alignItems: 'center', \n            justifyContent: 'center',\n            backgroundColor: '#1f2937', // bg-gray-800\n            borderRadius: '9999px',\n            overflow: 'hidden',\n            border: '2px solid #374151', // border-gray-700\n            boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)'\n          }}\n        >\n          <img \n            src=\"/Gemini_Generated_Image_rf3m8frf3m8frf3m.png\" \n            alt=\"Agent\" \n            style={{ \n              width: '100%', \n              height: '100%', \n              objectFit: 'cover',\n              display: 'block'\n            }} \n          />\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AANA;;;;;;;AAQe,SAAS;IACtB,MAAM,SAAS,IAAA,gMAAS;IACxB,MAAM,YAAY,OAAO,SAAS;IAClC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,kQAAQ,EAAC;IAE/C,MAAM,gBAAgB;QACpB,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB;IAEA,qBACE,+RAAC;QAAI,WAAU;;0BAEb,+RAAC;gBACC,SAAS,IAAM,eAAe,CAAC;gBAC/B,WAAU;gBACV,OAAM;0BAEL,4BAAc,+RAAC,kPAAC;oBAAC,MAAM;;;;;yCAAS,+RAAC,2PAAI;oBAAC,MAAM;;;;;;;;;;;YAI9C,6BACC,+RAAC;gBAAI,WAAU;;kCAEb,+RAAC;wBACC,WAAU;wBACV,SAAS,IAAM,eAAe;;;;;;kCAGhC,+RAAC;wBAAI,WAAU;kCACb,cAAA,+RAAC,yLAAO;4BACN,kBAAkB;4BAClB,WAAW;4BACX,SAAS,IAAM,eAAe;;;;;;;;;;;;;;;;;0BAOtC,+RAAC;gBAAI,WAAU;0BAGb,cAAA,+RAAC;oBAAI,WAAU;8BAIb,cAAA,+RAAC;wBAAI,WAAU;kCACb,cAAA,+RAAC,4LAAU;4BAAC,WAAW;;;;;;;;;;;;;;;;;;;;;0BAO7B,+RAAC;gBAAI,WAAU;0BACb,cAAA,+RAAC;oBACC,OAAO;wBACL,OAAO;wBACP,QAAQ;wBACR,SAAS;wBACT,YAAY;wBACZ,gBAAgB;wBAChB,iBAAiB;wBACjB,cAAc;wBACd,UAAU;wBACV,QAAQ;wBACR,WAAW;oBACb;8BAEA,cAAA,+RAAC;wBACC,KAAI;wBACJ,KAAI;wBACJ,OAAO;4BACL,OAAO;4BACP,QAAQ;4BACR,WAAW;4BACX,SAAS;wBACX;;;;;;;;;;;;;;;;;;;;;;AAMZ"}}]
}